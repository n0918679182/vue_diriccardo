import{d as E,e as i,S as u,_ as S,f as v,m as f,r as k,o as l,c as r,b as w,a as t,F as m,g as _,j as B,t as p,h as O,l as I,p as C,k as L}from"./index-dae28ad8.js";import{c as T}from"./cartStore-5a7d47f3.js";const y=E("eventStore",{state:()=>({events:[],tempEvent:{},tempBr:{subTitle:[],detail:[]}}),actions:{getEvents(){i.get("http://localhost:3000/event").then(e=>{this.events=e.data}).catch(e=>alert(e.response.data.message))},getEvent(e){this.tempEvent=e,this.tempBr.subTitle=this.tempEvent.subTitle.split(`
`),this.tempBr.detail=this.tempEvent.detail.split(`
`)},async addToOrder(){const{randomOrderId:e}=T();let n=!1,h=0,b=0;const o={orders:[]};o.tableId=localStorage.getItem("tableId"),o.staffId=localStorage.getItem("staffId"),o.time=new Date,o.subtotal=this.tempEvent.price;const g=e();o.serial=g,o.user=0,o.orders.push(this.tempEvent.productNum),await i.get("http://localhost:3000/orderList").then(a=>{a.data.forEach(s=>{s.tableId==localStorage.getItem("tableId")?(n=!0,h=s.id,b=s.subtotal,s.orders.forEach(d=>{o.orders.push(d)})):localStorage.getItem("orderId")||localStorage.setItem("orderId",a.data.length)})}),n?i.patch("http://localhost:3000/orderList/"+h,{orders:o.orders,subtotal:b+o.subtotal}).then(a=>{document.getElementById("checkOrderClose").click(),u.fire({icon:"success",title:"餐點已送出",showConfirmButton:!1,timer:1500})}).catch(a=>alert(a.response.data.message)):(i.post("http://localhost:3000/orderList",o).then(a=>{document.getElementById("checkOrderClose").click(),u.fire({icon:"success",title:"餐點已送出",showConfirmButton:!1,timer:1500})}).catch(a=>alert(a.response.data.message)),i.get("http://localhost:3000/tableState").then(a=>{let s;s=a.data.filter(d=>d.tableId==localStorage.getItem("tableId"))[0].id,i.patch("http://localhost:3000/tableState/"+s,{orderSerial:g}).catch(d=>alert(d.response.data.message))}))}}}),V="/vue_diriccardo/assets/ordered-bg1-682d8135.png",M="/vue_diriccardo/assets/ordered-bg2-76e01605.png";const N={computed:{...v(y,["events","tempEvent","tempBr"]),...v(I,["isLoading"])},methods:{...f(y,["getEvents","getEvent","addToOrder"]),...f(I,["loading"])},mounted(){this.getEvents(),this.loading()}},c=e=>(C("data-v-5f480f68"),e=e(),L(),e),$={class:"event w-100 pt-4 overflow-hidden position-relative vh-100"},x=c(()=>t("img",{src:V,class:"eventBg_img1",alt:""},null,-1)),U=c(()=>t("img",{src:M,class:"eventBg_img2",alt:""},null,-1)),z={class:"container mt-20 pt-4"},D={class:"bg-event row rounded-2 p-4 border border-white"},F=["onClick"],j=["src"],A={class:"modal fade",id:"eventModal",tabindex:"-1","aria-labelledby":"eventModallLabel","aria-hidden":"true"},q={class:"modal-dialog modal-lg modal-dialog-centered"},G={class:"modal-content position-relative"},H={class:"modal-body row"},J=c(()=>t("button",{type:"button",style:{"z-index":"20"},class:"btn-close position-absolute top-0 end-0 me-6 mt-3","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),K={class:"col-4 p-3"},P=["src"],Q={key:0,class:"btn btn-outline-dark btn-sm",style:{width:"233px"},type:"bottom","data-bs-toggle":"modal","data-bs-target":"#checkOrderModal"},R={class:"col-8 p-3"},W={class:"h5 fw-bold mb-3"},X={class:"border-start border-3 border-dark ms-1 mb-4 ps-2"},Y=c(()=>t("h3",{class:"h5 mb-3 fw-bolder"},"活動資訊",-1)),Z={class:"border-start border-3 border-dark ms-1 mb-4 ps-2"},tt={class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",id:"checkOrderModal",tabindex:"-1","aria-labelledby":"checkOrderModalLabel","aria-hidden":"true"},et={class:"modal-dialog modal-dialog-centered"},st={class:"modal-content"},ot={class:"modal-body text-center pt-10"},at={class:"text-danger"},dt=c(()=>t("p",null,"確定點購嗎？",-1)),lt={class:"modal-footer"},rt=c(()=>t("button",{type:"button",class:"btn btn-outline-danger","data-bs-target":"#eventModal","data-bs-toggle":"modal",id:"checkOrderClose"},"取消",-1));function nt(e,n,h,b,o,g){const a=k("VueLoading");return l(),r(m,null,[w(a,{active:e.isLoading,"onUpdate:active":n[0]||(n[0]=s=>e.isLoading=s)},null,8,["active"]),t("div",$,[x,U,t("div",z,[t("div",D,[(l(!0),r(m,null,_(e.events,s=>(l(),r("div",{class:"col-4",key:s.id},[t("div",{class:"w-100",style:{height:"450px"},"data-bs-toggle":"modal","data-bs-target":"#eventModal",onClick:d=>e.getEvent(s)},[t("img",{src:s.imgUrl,alt:"",class:"img-fluid"},null,8,j)],8,F)]))),128))])])]),t("div",A,[t("div",q,[t("div",G,[t("div",H,[J,t("div",K,[t("img",{src:e.tempEvent.imgUrl,alt:"",class:"img-fluid mb-3"},null,8,P),e.tempEvent.type=="productSell"?(l(),r("button",Q," 我要點餐")):B("",!0)]),t("div",R,[t("h2",W,p(e.tempEvent.title),1),t("div",X,[(l(!0),r(m,null,_(e.tempBr.subTitle,s=>(l(),r("p",{key:s,class:"mb-0 h7"},p(s),1))),128))]),Y,t("div",Z,[(l(!0),r(m,null,_(e.tempBr.detail,(s,d)=>(l(),r("p",{key:d,class:"mb-0",style:{"font-size":"14px","max-width":"450px"}},p(s),1))),128))])])])])])]),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("p",null,[O("即將點購 "),t("span",at,p(e.tempEvent.title),1)]),dt]),t("div",lt,[rt,t("button",{type:"button",class:"btn btn-danger",onClick:n[1]||(n[1]=(...s)=>e.addToOrder&&e.addToOrder(...s))},"確定")])])])])],64)}const mt=S(N,[["render",nt],["__scopeId","data-v-5f480f68"]]);export{mt as default};
