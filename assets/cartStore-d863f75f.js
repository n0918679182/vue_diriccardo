import{d as i,e as a,S as l}from"./index-30f8bfb7.js";const m=i("cartStore",{state:()=>({tempProduct:{count:1,id:0,imgUrl:"",name:"",price:0},chosenOrders:[]}),actions:{getOrderItem(r){this.tempProduct.id=r.id,this.tempProduct.imgUrl=r.imgUrl,this.tempProduct.name=r.name,this.tempProduct.price=r.price},sentOrderItem(){this.tempProduct.count>0&&(localStorage.getItem("chosenOrders")&&(this.chosenOrders=JSON.parse(localStorage.getItem("chosenOrders")),localStorage.removeItem("chosenOrders")),this.chosenOrders.push(this.tempProduct),localStorage.setItem("chosenOrders",JSON.stringify(this.chosenOrders)),this.tempProduct={count:0,id:0,imgUrl:"",name:"",price:0}),document.getElementById("closeOrderItemModal").click()},getChonseOrders(){localStorage.getItem("chosenOrders")?this.chosenOrders=JSON.parse(localStorage.getItem("chosenOrders")):this.chosenOrders=[]},totalChosenOrdersCount(){let r=0;return this.chosenOrders.forEach(s=>{r+=s.count}),r},totalChosenOrdersPrice(){let r=0;return this.chosenOrders.forEach(s=>{r+=s.price*s.count}),r},cancelOrderItem(r){this.chosenOrders.splice(r,1),localStorage.setItem("chosenOrders",JSON.stringify(this.chosenOrders))},cancelAllChosen(){this.chosenOrders=[],localStorage.removeItem("chosenOrders")},async createOrder(){let r=!1,s=0;const d=[],t={orders:[]};t.tableId=localStorage.getItem("tableId"),t.staffId=localStorage.getItem("staffId"),t.time=new Date().getTime(),t.subtotal=this.totalChosenOrdersPrice();const o=this.randomOrderId();t.serial=o,localStorage.getItem("userId")?t.user=localStorage.getItem("userId"):t.user=0,this.chosenOrders.forEach(e=>{for(let c=0;c<e.count;c++)t.orders.push(e.id)}),await a.get("https://diriccardo-server.onrender.com/orderList").then(e=>{localStorage.setItem("orderId",e.data.length),e.data.forEach(c=>{c.tableId==localStorage.getItem("tableId")&&(r=!0,s=c.id,c.orders.forEach(n=>{d.push(n)}))})}).catch(e=>console.dir(e)),await this.addToKitchen(t),r?(t.orders.forEach(e=>{d.push(e)}),a.patch("https://diriccardo-server.onrender.com/orderList/"+s,{orders:d}).then(e=>{this.cancelAllChosen(),document.getElementById("chosenOrdersCloseBtn").click(),l.fire({icon:"success",title:"餐點已送出",showConfirmButton:!1,timer:1500})}).catch(e=>console.dir(e))):(a.post("https://diriccardo-server.onrender.com/orderList",t).then(e=>{this.cancelAllChosen(),document.getElementById("chosenOrdersCloseBtn").click(),l.fire({icon:"success",title:"餐點已送出",showConfirmButton:!1,timer:1500})}).catch(e=>console.dir(e)),a.get("https://diriccardo-server.onrender.com/tableState").then(e=>{let c;c=e.data.filter(n=>n.tableId==localStorage.getItem("tableId"))[0].id,a.patch("https://diriccardo-server.onrender.com/tableState/"+c,{orderSerial:o}).catch(n=>console.dir(n))}))},async addToKitchen(r){let s=!1,d=0;const t=[];if(await a.get("https://diriccardo-server.onrender.com/kitchenOrders").then(o=>{o.data.forEach(e=>{e.tableId==localStorage.getItem("tableId")&&(s=!0,d=e.id,e.orders.forEach(c=>{t.push(c)}))})}).catch(o=>console.dir(o)),s)r.orders.forEach(o=>{t.push(o)}),a.patch("https://diriccardo-server.onrender.com/kitchenOrders/"+d,{orders:t}).catch(o=>console.dir(o));else{const o={tableId:r.tableId,orders:r.orders};a.post("https://diriccardo-server.onrender.com/kitchenOrders",o).catch(e=>console.dir(e))}},randomOrderId(){const r="AB1CD3EF2GH4IJ5KL6MN7OP8QR9ST0UVWXYZ";let s="";for(let d=0;d<10;d++){let t=Math.random()*36;s+=r.substring(t,t+1)}return s},getChosenOrders(){localStorage.getItem("chosenOrders")&&(this.chosenOrders=JSON.parse(localStorage.getItem("chosenOrders")))}}});export{m as c};
