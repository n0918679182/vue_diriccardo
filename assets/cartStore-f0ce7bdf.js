import{d as n,e as l,S as h}from"./index-a72cdf0a.js";const m=n("cartStore",{state:()=>({tempProduct:{count:0,id:0,imgUrl:"",name:"",price:0},chosenOrders:[]}),actions:{getOrderItem(e){this.tempProduct.id=e.id,this.tempProduct.imgUrl=e.imgUrl,this.tempProduct.name=e.name,this.tempProduct.price=e.price},sentOrderItem(){this.tempProduct.count>0&&(localStorage.getItem("chosenOrders")&&(this.chosenOrders=JSON.parse(localStorage.getItem("chosenOrders")),localStorage.removeItem("chosenOrders")),this.chosenOrders.push(this.tempProduct),localStorage.setItem("chosenOrders",JSON.stringify(this.chosenOrders)),this.tempProduct={count:0,id:0,imgUrl:"",name:"",price:0}),document.getElementById("closeOrderItemModal").click()},getChonseOrders(){localStorage.getItem("chosenOrders")?this.chosenOrders=JSON.parse(localStorage.getItem("chosenOrders")):this.chosenOrders=[]},totalChosenOrdersCount(){let e=0;return this.chosenOrders.forEach(s=>{e+=s.count}),e},totalChosenOrdersPrice(){let e=0;return this.chosenOrders.forEach(s=>{e+=s.price*s.count}),e},cancelOrderItem(e){this.chosenOrders.splice(e,1),localStorage.setItem("chosenOrders",JSON.stringify(this.chosenOrders))},cancelAllChosen(){this.chosenOrders=[],localStorage.removeItem("chosenOrders")},async createOrder(){let e=!1,s=0;const c=[],r={orders:[]};r.tableId=localStorage.getItem("tableId"),r.staffId=localStorage.getItem("staffId"),r.time=new Date().getTime(),r.subtotal=this.totalChosenOrdersPrice();const a=this.randomOrderId();r.serial=a,localStorage.getItem("userId")?r.user=localStorage.getItem("userId"):r.user=0,this.chosenOrders.forEach(t=>{for(let o=0;o<t.count;o++)r.orders.push(t.id)}),await l.get("http://localhost:3000/orderList").then(t=>{localStorage.setItem("orderId",t.data.length),t.data.forEach(o=>{o.tableId==localStorage.getItem("tableId")&&(e=!0,s=o.id,o.orders.forEach(d=>{c.push(d)}))})}),await this.addToKitchen(r),e?(r.orders.forEach(t=>{c.push(t)}),l.patch("http://localhost:3000/orderList/"+s,{orders:c}).then(t=>{this.cancelAllChosen(),document.getElementById("chosenOrdersCloseBtn").click(),h.fire({icon:"success",title:"餐點已送出",showConfirmButton:!1,timer:1500})}).catch(t=>alert(t.response.data.message))):(l.post("http://localhost:3000/orderList",r).then(t=>{this.cancelAllChosen(),document.getElementById("chosenOrdersCloseBtn").click(),h.fire({icon:"success",title:"餐點已送出",showConfirmButton:!1,timer:1500})}).catch(t=>alert(t.response.data.message)),l.get("http://localhost:3000/tableState").then(t=>{let o;o=t.data.filter(d=>d.tableId==localStorage.getItem("tableId"))[0].id,l.patch("http://localhost:3000/tableState/"+o,{orderSerial:a}).catch(d=>alert(d.response.data.message))}))},async addToKitchen(e){let s=!1,c=0;const r=[];if(await l.get("http://localhost:3000/kitchenOrders").then(a=>{a.data.forEach(t=>{t.tableId==localStorage.getItem("tableId")&&(s=!0,c=t.id,t.orders.forEach(o=>{r.push(o)}))})}),s)e.orders.forEach(a=>{r.push(a)}),l.patch("http://localhost:3000/kitchenOrders/"+c,{orders:r}).catch(a=>alert(a.response.data.message));else{const a={tableId:e.tableId,orders:e.orders};l.post("http://localhost:3000/kitchenOrders",a).catch(t=>alert(t.response.data.message))}},randomOrderId(){const e="AB1CD3EF2GH4IJ5KL6MN7OP8QR9ST0UVWXYZ";let s="";for(let c=0;c<10;c++){let r=Math.random()*36;s+=e.substring(r,r+1)}return s},getChosenOrders(){localStorage.getItem("chosenOrders")&&(this.chosenOrders=JSON.parse(localStorage.getItem("chosenOrders")))}}});export{m as c};
